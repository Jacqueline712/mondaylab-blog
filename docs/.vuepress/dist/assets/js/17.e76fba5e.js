(window.webpackJsonp=window.webpackJsonp||[]).push([[17],{568:function(t,s,a){"use strict";a.r(s);var n=a(13),e=Object(n.a)({},(function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[a("h1",{attrs:{id:"前言"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#前言"}},[t._v("#")]),t._v(" 前言")]),t._v(" "),a("p",[a("code",[t._v("队列")]),t._v(" 在日常生活中的应用非常广泛，比如我们最熟悉不过的食堂排队打饭、击鼓传花等等问题。同时，它在前端中的应用也非常广泛，比如，事件循环 "),a("code",[t._v("Event loop")]),t._v(" 、JS 异步中的任务队列。")]),t._v(" "),a("p",[t._v("所以呢，对于前端来说， "),a("code",[t._v("队列")]),t._v(" 结构是一个必学的知识点。在接下来的这篇文章中，将讲解关于 "),a("code",[t._v("队列")]),t._v(" 在前端中的应用。")]),t._v(" "),a("h1",{attrs:{id:"一、队列是什么"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#一、队列是什么"}},[t._v("#")]),t._v(" 一、队列是什么")]),t._v(" "),a("p",[t._v("队列是一种"),a("strong",[t._v("先进先出")]),t._v("（FIFO）的线性表。它只允许在表的"),a("strong",[t._v("一端")]),t._v("进行插入，而在"),a("strong",[t._v("另一端")]),t._v("删除元素。")]),t._v(" "),a("h1",{attrs:{id:"二、应用场景"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#二、应用场景"}},[t._v("#")]),t._v(" 二、应用场景")]),t._v(" "),a("ul",[a("li",[t._v("需要先进先出的场景。")]),t._v(" "),a("li",[t._v("比如：食堂排队打饭、火车站排队买票、JS 异步中的任务队列、计算最近请求次数……。")])]),t._v(" "),a("h1",{attrs:{id:"三、前端与队列-事件循环与任务队列"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#三、前端与队列-事件循环与任务队列"}},[t._v("#")]),t._v(" 三、前端与队列：事件循环与任务队列")]),t._v(" "),a("h2",{attrs:{id:"_1、event-loop"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1、event-loop"}},[t._v("#")]),t._v(" 1、event loop")]),t._v(" "),a("p",[a("code",[t._v("event loop")]),t._v("，也被称为"),a("strong",[t._v("事件循环")]),t._v("或"),a("strong",[t._v("事件轮询")]),t._v("。因为 JS 是单线程运行的，且异步需要基于回调来实现，所以， "),a("code",[t._v("event loop")]),t._v(" 就是异步回调的实现原理。")]),t._v(" "),a("h2",{attrs:{id:"_2、js-如何执行"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2、js-如何执行"}},[t._v("#")]),t._v(" 2、JS 如何执行")]),t._v(" "),a("p",[a("strong",[t._v("JS 在程序中的执行遵循以下规则：")])]),t._v(" "),a("ul",[a("li",[t._v("从前到后，一行一行执行")]),t._v(" "),a("li",[t._v("如果某一行执行报错，则停止下面代码的执行")]),t._v(" "),a("li",[t._v("先把同步代码执行完，再执行异步")])]),t._v(" "),a("p",[t._v("一起来看一个实例：")]),t._v(" "),a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[t._v("console"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'Hi'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("setTimeout")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("cb1")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  console"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'cb1'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//cb1 即callback回调函数")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("5000")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\nconsole"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'Bye'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//打印顺序：")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//Hi")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//Bye")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//cb1")]),t._v("\n")])])]),a("p",[t._v("从上例代码中可以看到， "),a("code",[t._v("JS")]),t._v(" 是先执行同步代码，所以先打印 "),a("code",[t._v("Hi")]),t._v(" 和 "),a("code",[t._v("Bye")]),t._v(" ，之后执行异步代码，打印出 "),a("code",[t._v("cb1")]),t._v(" 。")]),t._v(" "),a("p",[t._v("以此代码为例，下面开始讲解 "),a("code",[t._v("event loop")]),t._v(" 的过程。")]),t._v(" "),a("h2",{attrs:{id:"_3、event-loop-过程"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3、event-loop-过程"}},[t._v("#")]),t._v(" 3、event loop 过程")]),t._v(" "),a("p",[t._v("对于上面这段代码，执行过程如下图所示。")]),t._v(" "),a("p",[a("img",{attrs:{src:"https://img-blog.csdnimg.cn/20210520163909621.gif#pic_center",alt:"在这里插入图片描述"}})]),t._v(" "),a("p",[t._v("从上图中可以分析出这段代码的运行轨迹。首先 "),a("code",[t._v("console.log('Hi')")]),t._v(" 是同步代码，直接执行并打印出 "),a("code",[t._v("Hi")]),t._v(" 。接下来继续执行定时器 "),a("code",[t._v("setTimeout")]),t._v(" ，定时器是异步代码，所以这个时候浏览器会将它交给 "),a("code",[t._v("Web APIs")]),t._v(" 来处理这件事情，因此先把它放到 "),a("code",[t._v("Web APIs")]),t._v(" 中，之后继续执行 "),a("code",[t._v("console.log('Bye')")]),t._v(" ， "),a("code",[t._v("console.log('Bye')")]),t._v(" 是同步代码，在调用堆栈 "),a("code",[t._v("Call Stack")]),t._v(" 中执行，打印出 "),a("code",[t._v("Bye")]),t._v(" 。")]),t._v(" "),a("p",[t._v("到这里，调用堆栈 "),a("code",[t._v("Call Stack")]),t._v(" 里面的内容全部执行完毕，当调用堆栈的内容为空时，浏览器就会开始去任务队列寻找下一个任务，此时任务队列就会去 "),a("code",[t._v("Web API")]),t._v(" 里面寻找任务，遵循先进先出原则，找到了定时器，且定时器里面是回调函数 "),a("code",[t._v("cb1")]),t._v(" ，于是把回调函数 "),a("code",[t._v("cb1")]),t._v(" 传入任务队列中，此时 "),a("code",[t._v("Web API")]),t._v(" 也空了，任务队列里面的任务就会传入到调用堆栈里"),a("code",[t._v("Call Stack")]),t._v(" 里执行，最终打印出 "),a("code",[t._v("cb1")]),t._v(" 。")]),t._v(" "),a("h2",{attrs:{id:"_4、-dom-事件和-event-loop"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4、-dom-事件和-event-loop"}},[t._v("#")]),t._v(" 4、 DOM 事件和 event loop")]),t._v(" "),a("p",[t._v("先来看两段代码。")]),t._v(" "),a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[t._v("console"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'Hi'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("setTimeout")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("cb1")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  console"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'cb1'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//cb 即 callback")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("5000")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\nconsole"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'Bye'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("/*\n 输出结果：\nHi\nBye\ncb1\n*/")]),t._v("\n")])])]),a("div",{staticClass:"language-html extra-class"},[a("pre",{pre:!0,attrs:{class:"language-html"}},[a("code",[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("button")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("id")]),a("span",{pre:!0,attrs:{class:"token attr-value"}},[a("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("btn1"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("提交"),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("button")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("script")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),a("span",{pre:!0,attrs:{class:"token script"}},[a("span",{pre:!0,attrs:{class:"token language-javascript"}},[t._v("\n  console"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'Hi'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n  document"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("getElementById")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'btn1'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("click")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("e")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    console"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'button clicked'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n  console"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'Bye'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])]),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("script")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n\n/* 输出结果： Hi Bye button clicked */\n")])])]),a("p",[t._v("以上这两段代码中，第一段是关于 "),a("code",[t._v("setTimeout")]),t._v(" 的事件循环，第二段是关于 "),a("code",[t._v("DOM")]),t._v(" 事件的事件循环。那有小伙伴就会有疑问说， "),a("code",[t._v("DOM")]),t._v(" 事件不是异步操作吗，为什么输出结果依然是在最后呢？")]),t._v(" "),a("p",[t._v("其实， "),a("code",[t._v("DOM")]),t._v(" 事件确实不是异步操作，但是它也使用"),a("strong",[t._v("回调")]),t._v("，基于 "),a("code",[t._v("event loop")]),t._v(" 事件循环机制，所以当我们点击的时候，会触发 "),a("code",[t._v("DOM")]),t._v(" 事件，并进行打印。")]),t._v(" "),a("p",[t._v("总结下 "),a("code",[t._v("DOM")]),t._v(" 事件和 "),a("code",[t._v("event loop")]),t._v(" 的区别：")]),t._v(" "),a("ul",[a("li",[a("code",[t._v("JS")]),t._v(" 是单线程的；")]),t._v(" "),a("li",[t._v("异步（ "),a("code",[t._v("setTimeout")]),t._v(" ， "),a("code",[t._v("ajax")]),t._v(" 等）使用回调，基于 "),a("code",[t._v("event loop")]),t._v(" ；")]),t._v(" "),a("li",[a("code",[t._v("DOM")]),t._v(" 事件不是异步，但也使用回调，基于 "),a("code",[t._v("event loop")]),t._v(" 。")])]),t._v(" "),a("h2",{attrs:{id:"_5、event-loop-总结"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_5、event-loop-总结"}},[t._v("#")]),t._v(" 5、event loop 总结")]),t._v(" "),a("p",[t._v("初阶认识完 event loop 后，来做个总结：")]),t._v(" "),a("p",[a("strong",[t._v("总结 event loop 过程 1")])]),t._v(" "),a("ul",[a("li",[t._v("同步代码，一行一行放在 "),a("code",[t._v("Call Stack")]),t._v(" 执行；")]),t._v(" "),a("li",[t._v("遇到异步，会先“记录”下，等待时机（定时、网络请求）；")]),t._v(" "),a("li",[t._v("时机到了，就移动到 "),a("code",[t._v("Callback Queue")]),t._v("。")])]),t._v(" "),a("p",[a("strong",[t._v("总结 event loop 过程 2")])]),t._v(" "),a("ul",[a("li",[t._v("如果 "),a("code",[t._v("Call Stack")]),t._v(" 为空（即同步代码执行完），则 "),a("code",[t._v("event Loop")]),t._v(" 开始工作；")]),t._v(" "),a("li",[t._v("轮询查找 "),a("code",[t._v("Callback Queue")]),t._v(" ，如果有则移动到 "),a("code",[t._v("Call Stack")]),t._v(" 执行；")]),t._v(" "),a("li",[t._v("然后继续轮询查找（跟永动机一样，不断循环查找）。")])]),t._v(" "),a("h1",{attrs:{id:"四、宏任务和微任务"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#四、宏任务和微任务"}},[t._v("#")]),t._v(" 四、宏任务和微任务")]),t._v(" "),a("h2",{attrs:{id:"_1、引例"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1、引例"}},[t._v("#")]),t._v(" 1、引例")]),t._v(" "),a("p",[t._v("我们先来看一段代码。")]),t._v(" "),a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[t._v("console"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("100")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("setTimeout")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  console"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("200")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\nPromise"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("resolve")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("then")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  console"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("300")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\nconsole"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("400")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("/**\n * 打印结果：\n * 100\n * 400\n * 300\n * 200\n */")]),t._v("\n")])])]),a("p",[t._v("在上面这段代码中，第一个和第二个打印结果是基于同步，我们都知道要打印 "),a("code",[t._v("100")]),t._v(" 和 "),a("code",[t._v("400")]),t._v(" ，但是第三个和第四个打印结果，理论上按照打印顺序应该是 "),a("code",[t._v("200")]),t._v(" 和 "),a("code",[t._v("300")]),t._v(" 才是，为什么是打印 "),a("code",[t._v("300")]),t._v(" 和 "),a("code",[t._v("200")]),t._v(" 呢？这就涉及到一个"),a("strong",[t._v("宏任务和微任务的问题")]),t._v("。接下来将对宏任务和微任务进行讲解。")]),t._v(" "),a("h2",{attrs:{id:"_2、宏任务和微任务"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2、宏任务和微任务"}},[t._v("#")]),t._v(" 2、宏任务和微任务")]),t._v(" "),a("h3",{attrs:{id:"_1-常用的宏任务和微任务"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-常用的宏任务和微任务"}},[t._v("#")]),t._v(" （1）常用的宏任务和微任务")]),t._v(" "),a("table",[a("thead",[a("tr",[a("th",[t._v("名称")]),t._v(" "),a("th",[t._v("举例（常用）")])])]),t._v(" "),a("tbody",[a("tr",[a("td",[t._v("宏任务")]),t._v(" "),a("td",[t._v("script、setTimeout 、setInterval 、setImmediate、Ajax、DOM 事件、I/O、UI Rendering")])]),t._v(" "),a("tr",[a("td",[t._v("微任务")]),t._v(" "),a("td",[t._v("process.nextTick()、Promise、async/await")])])])]),t._v(" "),a("p",[t._v("上述的 "),a("code",[t._v("setTimeout")]),t._v(" 和 "),a("code",[t._v("setInterval")]),t._v(" 等都是任务源，真正进入任务队列的是他们分发的任务。")]),t._v(" "),a("p",[a("strong",[t._v("注意：")]),t._v(" 微任务执行时机比宏任务要早！！")]),t._v(" "),a("h3",{attrs:{id:"_2-宏任务和微任务的优先级"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-宏任务和微任务的优先级"}},[t._v("#")]),t._v(" （2）宏任务和微任务的优先级")]),t._v(" "),a("p",[a("strong",[t._v("优先级")])]),t._v(" "),a("ul",[a("li",[t._v("setTimeout = setInterval 一个队列")]),t._v(" "),a("li",[t._v("setTimeout > setImmediate")]),t._v(" "),a("li",[t._v("process.nextTick > Promise")])]),t._v(" "),a("h3",{attrs:{id:"_3-代码实现微任务和宏任务"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-代码实现微任务和宏任务"}},[t._v("#")]),t._v(" （3）代码实现微任务和宏任务")]),t._v(" "),a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("for")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" macroTask "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("of")]),t._v(" macroTaskQueue"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("handleMacroTask")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("for")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" microTask "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("of")]),t._v(" microTaskQueue"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("handleMicroTask")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),a("h3",{attrs:{id:"_4-event-loop-和-dom-渲染"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4-event-loop-和-dom-渲染"}},[t._v("#")]),t._v(" （4）event loop 和 DOM 渲染")]),t._v(" "),a("p",[t._v("在上面的"),a("strong",[t._v("主题三第 4 点")]),t._v("中讲过， "),a("code",[t._v("DOM")]),t._v(" 事件基于回调，也是基于 "),a("code",[t._v("event loop")]),t._v(" 机制的。那 DOM 事件在程序执行到什么时候，才会渲染呢？")]),t._v(" "),a("p",[t._v("同样来看这段代码。")]),t._v(" "),a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("button id "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"btn1"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("提交"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("button"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("script"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("\n    console"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'Hi'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n    document"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("getElementById")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'btn1'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("click")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("e")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        console"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'button clicked'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n    console"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'Bye'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("script"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("/*\n 输出结果：\nHi\nBye\nbutton clicked\n*/")]),t._v("\n")])])]),a("p",[a("img",{attrs:{src:"https://img-blog.csdnimg.cn/20210520163932223.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NDgwMzc1Mw==,size_16,color_FFFFFF,t_70#pic_center",alt:"event loop 和 DOM渲染"}})]),t._v(" "),a("p",[t._v("由上图可知，当程序调用栈空闲时，程序会先尝试去进行 "),a("code",[t._v("DOM")]),t._v(" 渲染，最后再触发 "),a("code",[t._v("Event Loop")]),t._v(" 机制。所以，在上面的这段代码中，程序会先打印同步代码 "),a("code",[t._v("Hi")]),t._v(" 和 "),a("code",[t._v("Bye")]),t._v(" ，等待同步代码打印完毕后，会再查找 "),a("code",[t._v("DOM")]),t._v(" 事件，进行渲染，最后再触发 "),a("code",[t._v("event loop")]),t._v(" 。")]),t._v(" "),a("p",[t._v("总结 "),a("code",[t._v("event loop")]),t._v(" 和 "),a("code",[t._v("DOM")]),t._v(" 渲染的关系：")]),t._v(" "),a("ul",[a("li",[a("p",[t._v("在程序执行的时候， "),a("code",[t._v("JS")]),t._v(" 是单线程的，且和 "),a("code",[t._v("DOM")]),t._v(" 渲染共用一个线程；")])]),t._v(" "),a("li",[a("p",[t._v("所以 "),a("code",[t._v("JS")]),t._v(" 在执行的时候，得留一些时机提供给 "),a("code",[t._v("DOM")]),t._v(" 渲染。")])]),t._v(" "),a("li",[a("p",[t._v("每次 "),a("code",[t._v("Call Stack")]),t._v(" 清空（即每次轮询结束），表示同步任务执行完成；")])]),t._v(" "),a("li",[a("p",[t._v("程序会一直给 "),a("code",[t._v("DOM")]),t._v(" 重新渲染的机会， "),a("code",[t._v("DOM")]),t._v(" 结构如有改变则重新渲染；")])]),t._v(" "),a("li",[a("p",[t._v("然后再去触发下一次 "),a("code",[t._v("Event Loop")]),t._v(" 。")])])]),t._v(" "),a("h3",{attrs:{id:"_5-微任务、宏任务和-dom-渲染的关系"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_5-微任务、宏任务和-dom-渲染的关系"}},[t._v("#")]),t._v(" （5）微任务、宏任务和 DOM 渲染的关系")]),t._v(" "),a("p",[t._v("先了解微任务、宏任务和 "),a("code",[t._v("DOM")]),t._v(" 渲染的关系：")]),t._v(" "),a("ul",[a("li",[a("strong",[t._v("宏任务：")]),t._v(" "),a("code",[t._v("DOM")]),t._v(" 渲染"),a("strong",[t._v("后")]),t._v("触发，如 "),a("code",[t._v("setTimeout")]),t._v(" 。")]),t._v(" "),a("li",[a("strong",[t._v("微任务：")]),t._v(" "),a("code",[t._v("DOM")]),t._v(" 渲染"),a("strong",[t._v("前")]),t._v("触发，如 "),a("code",[t._v("Promise")]),t._v(" 。")])]),t._v(" "),a("p",[t._v("我们先来演示现象，再追究其原理。")]),t._v(" "),a("p",[a("strong",[t._v("1）演示 1")])]),t._v(" "),a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" $p1 "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("$")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'<p>一段文字</p>'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" $p2 "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("$")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'<p>一段文字</p>'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" $p3 "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("$")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'<p>一段文字</p>'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("$")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'#container'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("append")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("$p1"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("append")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("$p2"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("append")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("$p3"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//微任务：DOM 渲染前触发")]),t._v("\nPromise"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("resolve")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("then")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  console"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'length'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("$")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'#container'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("children")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("length"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("alert")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'Promise then'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//(alert 会阻断 js 执行， 也会阻断 DOM 渲染，便于查看效果)")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),a("p",[t._v("以上这段代码中，浏览器显示效果如下。")]),t._v(" "),a("p",[a("img",{attrs:{src:"https://img-blog.csdnimg.cn/20210520164020196.gif#pic_center",alt:"微任务"}})]),t._v(" "),a("p",[t._v("在图中可以看出，微任务 "),a("code",[t._v("promise")]),t._v(" 在 "),a("code",[t._v("DOM")]),t._v(" 渲染前就触发了，所以 "),a("code",[t._v("DOM")]),t._v(" 对应的文字还没显示时， "),a("code",[t._v("Promise")]),t._v(" 就已经打印。")]),t._v(" "),a("p",[a("strong",[t._v("2）演示 2")])]),t._v(" "),a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" $p1 "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("$")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'<p>一段文字</p>'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" $p2 "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("$")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'<p>一段文字</p>'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" $p3 "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("$")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'<p>一段文字</p>'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("$")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'#container'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("append")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("$p1"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("append")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("$p2"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("append")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("$p3"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//宏任务：DOM 渲染后触发")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("setTimeout")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  console"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'length1'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("$")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'#container'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("children")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("length"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("alert")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'SetTimeout'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//(alert 会阻断 js 执行， 也会阻断 DOM 渲染，便于查看效果)")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),a("p",[t._v("以上这段代码中，浏览器显示效果如下。")]),t._v(" "),a("p",[a("img",{attrs:{src:"https://img-blog.csdnimg.cn/20210520164100186.gif#pic_center",alt:"宏任务"}})]),t._v(" "),a("p",[t._v("在图中可以看出，当 "),a("code",[t._v("DOM")]),t._v(" 对应的文字已经显示时， "),a("code",[t._v("setTimeout")]),t._v(" 弹框才出现，所以宏任务 "),a("code",[t._v("setTimeout")]),t._v(" 是在 "),a("code",[t._v("DOM")]),t._v(" 渲染后（即 "),a("code",[t._v("DOM")]),t._v(" 渲染并显示结束）才触发。")]),t._v(" "),a("p",[t._v("讲到这里，回到我们前面所说的知识点。")]),t._v(" "),a("ul",[a("li",[a("strong",[t._v("宏任务：")]),t._v(" "),a("code",[t._v("DOM")]),t._v(" 渲染"),a("strong",[t._v("后")]),t._v("触发，如 "),a("code",[t._v("setTimeout")]),t._v(" 。")]),t._v(" "),a("li",[a("strong",[t._v("微任务：")]),t._v(" "),a("code",[t._v("DOM")]),t._v(" 渲染"),a("strong",[t._v("前")]),t._v("触发，如 "),a("code",[t._v("Promise")]),t._v(" 。")])]),t._v(" "),a("p",[t._v("从上面的演示后，相信大家应该明白了微任务、宏任务和 "),a("code",[t._v("DOM")]),t._v(" 的关系。在第一个演示中，微任务 "),a("code",[t._v("Promise")]),t._v(" 在 "),a("code",[t._v("DOM")]),t._v(" 还没有渲染时就触发了，所以微任务都是在 "),a("code",[t._v("DOM")]),t._v(" 渲染前触发。在第二个演示中，宏任务 "),a("code",[t._v("setTimeout")]),t._v(" 在文字显示结束后才触发 "),a("code",[t._v("alert")]),t._v(" ，所以微任务都是在 "),a("code",[t._v("DOM")]),t._v(" 渲染后才进行触发。")]),t._v(" "),a("h3",{attrs:{id:"_6-为何微任务更早"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_6-为何微任务更早"}},[t._v("#")]),t._v(" （6）为何微任务更早")]),t._v(" "),a("p",[t._v("理解完微任务和宏任务与 DOM 的关系后，我们也大致基本了解了为什么微任务比宏任务更早。接下来我们在从 "),a("code",[t._v("eventloop")]),t._v(" 层面来看，为什么微任务会比宏任务更早，为什么会在 DOM 渲染前就开始触发呢？")]),t._v(" "),a("p",[t._v("先用一张图来表示。")]),t._v(" "),a("p",[a("img",{attrs:{src:"https://img-blog.csdnimg.cn/20210520164132570.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NDgwMzc1Mw==,size_16,color_FFFFFF,t_70#pic_center",alt:"微任务宏任务"}})]),t._v(" "),a("p",[t._v("微任务在执行时不会经过 "),a("code",[t._v("Web APIs")]),t._v(" ，它会把它放到一个叫做 micro task queue"),a("code",[t._v("（即宏任务队列）当中。且微任务是")]),t._v("ES6` 语法规定的，宏任务是由浏览器规定的，所以它会比宏任务更早。")]),t._v(" "),a("p",[t._v("到这里，我们讲完了 "),a("code",[t._v("event loop")]),t._v(" 以及与其相关的宏任务和微任务，下面我们再用一张图来总结实际运用的执行顺序。")]),t._v(" "),a("p",[a("img",{attrs:{src:"https://img-blog.csdnimg.cn/20210520164145692.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NDgwMzc1Mw==,size_16,color_FFFFFF,t_70#pic_center",alt:"微任务宏任务"}})]),t._v(" "),a("p",[a("strong",[t._v("从上图中可以得出结论：")])]),t._v(" "),a("p",[a("strong",[t._v("第一步")]),t._v("，程序先程序 "),a("code",[t._v("Call Stack")]),t._v(" 里面的内容，待 "),a("code",[t._v("Call Stack")]),t._v(" 清空时，执行当前的微任务；")]),t._v(" "),a("p",[a("strong",[t._v("第二步")]),t._v("，程序找到微任务队列的任务，执行微任务；")]),t._v(" "),a("p",[a("strong",[t._v("第三步")]),t._v("，待微任务执行完毕后，尝试执行 DOM 渲染；")]),t._v(" "),a("p",[a("strong",[t._v("第四步")]),t._v("， "),a("code",[t._v("DOM")]),t._v(" 渲染结束后，触发 "),a("code",[t._v("event loop")]),t._v(" ，执行宏任务。")]),t._v(" "),a("h1",{attrs:{id:"五、结束语"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#五、结束语"}},[t._v("#")]),t._v(" 五、结束语")]),t._v(" "),a("p",[t._v("队列在前端中的应用可以算是很非常频繁了。基本上我们写的异步函数在执行过程中，都会涉及到事件循环问题。且在前端的面试当中，经常会被问到 "),a("code",[t._v("event loop")]),t._v(" 、事件循环或者事件轮询是什么，很多面试者就很容易在这块内容吃亏。相信通过上文的学习，大家都对 "),a("code",[t._v("eventloop")]),t._v(" 、微任务和宏任务有了一个更深的认识。")]),t._v(" "),a("p",[t._v("队列在前端中的应用就讲到这里啦！如有不理解或者文章有误欢迎评论区留言或私信我交流~")]),t._v(" "),a("blockquote",[a("ul",[a("li",[a("p",[t._v("关注公众号 "),a("strong",[t._v("星期一研究室")]),t._v(" ，第一时间关注学习干货，"),a("strong",[t._v("更多有趣的专栏待你解锁")]),t._v("~")])]),t._v(" "),a("li",[a("p",[t._v("如果这篇文章对你有用，记得"),a("strong",[t._v("点个赞加个关注")]),t._v("再走哦~")])]),t._v(" "),a("li",[a("p",[t._v("我们下期见！🥂🥂🥂")])])])])])}),[],!1,null,null,null);s.default=e.exports}}]);